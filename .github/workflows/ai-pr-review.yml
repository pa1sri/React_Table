name: AI PR Review

on:
  pull_request:
    types: [opened, synchronize]

jobs:
  pr-review:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Generate Diff
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          gh pr diff ${{ github.event.pull_request.number }} > pr-diff.json

      - name: Invoke Lambda (No AWS Credentials Needed)
        run: |
          aws lambda invoke             --function-name AIPrReviewBasicLambda             --region ${{ secrets.AWS_REGION }}             --payload file://pr-diff.json             output.json

      - name: Show Lambda Output
        run: cat output.json